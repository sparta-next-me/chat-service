spring:
  h2:
    console:
      enabled: true               # H2 ì›¹ ì½˜ì†” í™œì„±í™”
      path: /h2-console           # ì ‘ì† URL ê²½ë¡œ

  datasource:
    url: ${DB_URL}      # ì¸ë©”ëª¨ë¦¬ DB (ê¸°ë³¸)
    driver-class-name: org.postgresql.Driver
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}

  application:
    name: chat-service

  config:
    import: 'optional:configserver:'

  #config server ì„ì‹œ ì°¨ë‹¨
  cloud:
    config:
      enabled: true
      service-id: config-server

  jpa:
    show-sql: true
    properties:
      hibernate:
        format_sql: true
    hibernate:
      ddl-auto: update

  data:
    redis:
      host: 34.50.7.8
      port: 6379

  main:
    allow-bean-definition-overriding: true

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    url: ${DB_URL}
    user: ${DB_USERNAME}
    password: ${DB_PASSWORD}

  kafka:
    bootstrap-servers: 34.22.87.75:9092, 34.22.87.75:9093, 34.22.87.75:9094 # Kafka ë¸Œë¡œì»¤(ë˜ëŠ” í´ëŸ¬ìŠ¤í„°) ì ‘ì† ì£¼ì†Œì™€ í¬íŠ¸, ì‰¼í‘œ(,)ë¡œ ë³µìˆ˜ ë¸Œë¡œì»¤ ì§€ì • ê°€ëŠ¥
    consumer:
      group-id: chat-group # ì»¨ìŠˆë¨¸ ê·¸ë£¹ ID: ê°™ì€ ê·¸ë£¹ì— ì†í•œ ì»¨ìŠˆë¨¸ë“¤ì€ íŒŒí‹°ì…˜ì„ ë¶„ë‹´í•˜ì—¬ ì²˜ë¦¬
      auto-offset-reset: earliest # ì»¨ìŠˆë¨¸ê°€ ì²˜ìŒ ì‹œì‘í•  ë•Œ ì˜¤í”„ì…‹ì´ ì—†ìœ¼ë©´ ì–´ë””ì„œë¶€í„° ì½ì„ì§€ ì„¤ì •, earliest: ê°€ì¥ ì˜¤ë˜ëœ(ì²˜ìŒ) ë©”ì„¸ì§€ë¶€í„°, latest: ìµœì‹  ë©”ì„¸ì§€ ë¶€í„°
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer # ë©”ì‹œì§€ í‚¤ ì—­ì§ë ¬í™”ê¸°(ë¬¸ìì—´ë¡œ ë””ì½”ë”©)
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      # value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer # ë©”ì‹œì§€ ê°’ ì—­ì§ë ¬í™”ê¸°(JSON -> ê°ì²´)
      properties:
        spring.json.trusted.packages: '*' # JsonDeserializerê°€ ì‹ ë¢°í•  íŒ¨í‚¤ì§€ ëª©ë¡, '*' ëª¨ë“  íŒ¨í‚¤ì§€ë¥¼ ì‹ ë¢°(ë³´ì•ˆìƒ ì·¨ì•½í•´ ì§€ë¯€ë¡œ ê°€ëŠ¥í•œ ê²½ìš° íŒ¨í‚¤ì§€ë¥¼ ëª…ì‹œ)
        spring.json.add.type.headers: true
        #spring.json.value.default.type: org.nextme.chat_server.infrastructure.kafka.dto.ChatMessage
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer # ë©”ì‹œì§€ í‚¤ ì§ë ¬í™”
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer # ë©”ì‹œì§€ ê°’ ì§ë ¬í™”(ê°ì²´ -> JSON)
      properties:
        spring.json.add.type.headers: false

  # local ê°œë°œìš© ollama ëª¨ë¸ ì‚¬ìš©
#  ai:
#    model:
#      chat: ollama
#    ollama:
#      base-url: http://localhost:11434
#      chat:
#        options:
#          model: huihui_ai/kanana-nano-abliterated
#          temperature: 0.5
  ai:
    openai:
      api-key: ${API_KEY}          # LLMìš© OpenAI API í‚¤
      model: gpt-5-nano
      embedding:
        api-key: ${API_KEY}        # ì„ë² ë”©ìš© OpenAI API í‚¤
        model: text-embedding-3-small

  rag:
    embedding-model: text-embedding-3-small
  init:
    pull-model-strategy: when_missing
    timeout: 180s
    max-retries: 1

logging:
  level:
    org.mybatis: DEBUG
    org.apache.ibatis: DEBUG
    org.nextme.chat_server.infrastructure.mybatis.mapper: DEBUG

# OPEN DOC API ì„¤ì •
springdoc:
  version: '1.0.0'
  api-docs:
    path: /v3/api-docs
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
  swagger-ui:
    operations-sorter: alpha
    tags-sorter: alpha
    path: /api-docs.html
    disable-swagger-default-url: true
    doc-expansion: full
  paths-to-match:
    - /**

openapi:
  service:
    url: http://34.50.7.8:3000

server:
  port: 18080

jwt:
  secret: ${JWT_SECRET}
  access-token-validity-seconds: 1800
  refresh-token-validity-seconds: 1209600

# MyBatis ì„¤ì •
mybatis:
  mapper-locations: classpath:mapper/**/*.xml  # XML ìœ„ì¹˜
  type-aliases-package: org.nextme.chat_server.infrastructure.mybatis.dto  # DTO íŒ¨í‚¤ì§€
  configuration:
    map-underscore-to-camel-case: true  # snake_case â†’ camelCase ìë™ ë³€í™˜
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl  # ë¡œê¹…
    database-id: PostgreSQL  # ë˜ëŠ” PostgreSQL

eureka:
  instance:
    prefer-ip-address: false
    hostname: localhost

  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: ${EUREKA_URL}

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics  # ğŸ‘ˆ ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€
  endpoint:
    prometheus:
      enabled: true  # ğŸ‘ˆ í™œì„±í™”
    metrics:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true  # ğŸ‘ˆ Prometheus ë‚´ë³´ë‚´ê¸° í™œì„±í™”